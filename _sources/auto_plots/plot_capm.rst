
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_plots/plot_capm.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_plots_plot_capm.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_plots_plot_capm.py:


Capital Asset Pricing Model
===========================

.. GENERATED FROM PYTHON SOURCE LINES 9-101



.. image-sg:: /auto_plots/images/sphx_glr_plot_capm_001.png
   :alt: Capital Asset Pricing Model (CAPM)
   :srcset: /auto_plots/images/sphx_glr_plot_capm_001.png
   :class: sphx-glr-single-img





.. code-block:: Python


    # Author: Dialid Santiago <d.santiago@outlook.com>
    # License: MIT
    # Description: Advent Calendar 2025 - Plot Capital Asset Pricing Model (CAPM) 
    import numpy as np
    import matplotlib.pyplot as plt
    from scipy.optimize import minimize

    plt.style.use(
        "https://raw.githubusercontent.com/quantgirluk/matplotlib-stylesheets/main/quant-pastel-light.mplstyle")    


    # Asset inputs
    mu = np.array([0.18, 0.020, 0.1, 0.07]) # expected returns
    variances = np.array([0.20, 0.18, 0.15, 0.19]) # variances
    sdtdevs = np.sqrt(variances)
    n = len(mu)
    Sigma = np.array([
    [variances[0], 0.02, 0.04, 0.01],
    [0.02, variances[1], 0.02, 0.01],
    [0.04, 0.02, variances[2], 0.03],
    [0.01, 0.01, 0.03, variances[3]]
    ])

    # Porftfolio simulation
    n_portfolios = 5000
    returns = np.zeros(n_portfolios)
    risks = np.zeros(n_portfolios)

    for i in range(n_portfolios):
        w = np.random.rand(n)
        w /= w.sum()
        returns[i] = w @ mu
        risks[i] = np.sqrt(w @ Sigma @ w)


    # Sharpe ratios
    r_f = 0.04  # risk-free rate
    sharpes = (returns - r_f) / risks

    # Tangency portfolio (maximum Sharpe ratio)
    idx = np.argmax(sharpes)
    tan_return = returns[idx]
    tan_risk = risks[idx]

    # Capital Market Line
    sml_x = np.linspace(0, risks.max(), 100)
    sml_y = r_f + (tan_return - r_f) / tan_risk * sml_x

    # Constraints
    cons_sum = {'type': 'eq', 'fun': lambda w: np.sum(w) - 1}
    bounds = [(0, 1)] * n

    # Portfolio functions
    def port_return(w):
        return w @ mu

    def port_risk(w):
        return np.sqrt(w @ Sigma @ w)

    # Minimum variance portfolio
    res_mvp = minimize(port_risk, x0=np.ones(n)/n,
    bounds=bounds, constraints=cons_sum)
    w_mvp = res_mvp.x

    # Efficient frontier
    target_returns = np.linspace(mu.min(), mu.max(), 50)
    frontier_risk = []

    for r in target_returns:
        cons = (
        cons_sum,
        {'type': 'eq', 'fun': lambda w, r=r: w @ mu - r}
        )
        res = minimize(port_risk, x0=np.ones(n)/n,
        bounds=bounds, constraints=cons)
        frontier_risk.append(res.fun)
    
    # Plot
    fig, ax = plt.subplots(figsize=(12, 7), dpi=200)
    plt.scatter(risks, returns, c=sharpes, cmap="coolwarm_r", alpha=0.25)
    plt.colorbar(label="Sharpe Ratio")
    plt.scatter(sdtdevs, mu, marker='o', s=50, color='black', edgecolor='black', zorder=5, label="Individual Assets")
    plt.plot(sml_x, sml_y, linestyle='-', linewidth=2, label="Capital Market Line (CML)", color="lightgreen")
    plt.plot(frontier_risk, target_returns, linewidth=2, linestyle='--', color="steelblue", label="Efficient Frontier")
    plt.scatter(port_risk(w_mvp), port_return(w_mvp), s=200, marker='*', color='red', zorder=5, label="Minimum Variance Portfolio")
    plt.scatter(tan_risk, tan_return, s=200, marker='*', color='magenta', zorder=5, label="Maximum Sharpe Ratio Portfolio")
    plt.scatter(0, r_f, s=200, marker='*', color='black', zorder=5, label="Risk-Free Portfolio")
    plt.xlabel("Risk (Std Dev)")
    plt.ylabel("Expected Return")
    plt.title("Capital Asset Pricing Model (CAPM)")
    plt.legend()
    plt.show()

.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 3.882 seconds)


.. _sphx_glr_download_auto_plots_plot_capm.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_capm.ipynb <plot_capm.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_capm.py <plot_capm.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_capm.zip <plot_capm.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
